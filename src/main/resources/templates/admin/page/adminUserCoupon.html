<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>쿠폰 맵핑 관리</title>
	<link rel="stylesheet" href="/css/adminPage.css" />
</head>

<body>
	<div th:insert="~{/admin/page/adminsidebar :: sidebar}"></div>
	<div class="main-content">
		<header>
			<h1>쿠폰 맵핑 관리</h1>
		</header>
		<div class="table-container">
			<table>
				<thead>
					<tr>
						<th>사용자 ID</th>
						<th>쿠폰 이름</th>
						<th>사용 여부</th>
						<th>발급 날짜</th>
						<th>사용 날짜</th>
						<th>관리</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="couponMap : ${couponMaps}" th:data-id="${couponMap.id}">
						<td th:text="${couponMap.userEntity.UId}"></td>
						<td th:text="${couponMap.couponEntity.couponName}"></td>
						<td th:text="${couponMap.used ? '사용됨' : '미사용'}"></td>
						<td th:text="${couponMap.assignedDate}"></td>
						<td th:text="${couponMap.usedDate != null ? couponMap.usedDate : '미사용'}"></td>
						<td>
							<button class="delete-coupon-btn" th:data-id="${couponMap.id}">
								쿠폰 삭제
							</button>
						</td>
					</tr>
					<!-- 다른 데이터 행들 -->
				</tbody>
			</table>
		</div>

		<!-- JavaScript 쿠폰 사용 처리 -->
		<script>
			document.addEventListener("DOMContentLoaded", function () {
				var deleteButtons = document.querySelectorAll(".delete-coupon-btn");
				deleteButtons.forEach(function (button) {
					button.addEventListener("click", function () {
						var couponMapId = button.getAttribute("data-id");
						if (confirm("해당 사용자의 쿠폰을 삭제하시겠습니까?")) {
							deleteCoupon(couponMapId);
						}
					});
				});

				function deleteCoupon(couponMapId) {
					fetch('/deleteCoupon?id=' + couponMapId, {
						method: 'DELETE' // DELETE 요청으로 전송
					})
						.then(response => {
							if (response.ok) {
								alert('쿠폰이 삭제되었습니다.');
								location.reload(); // 페이지 새로고침으로 목록 갱신
							} else {
								alert('쿠폰 삭제에 실패했습니다.');
							}
						})
						.catch(error => {
							console.error('Error deleting coupon:', error);
							alert('쿠폰 삭제 중 오류가 발생했습니다.');
						});
				}
			});
		</script>
	</div>
</body>

</html>
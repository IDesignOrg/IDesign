<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>상품 상세 페이지</title>
	<link rel="stylesheet" href="/css/style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<style>
		.product-page {
			font-family: Arial, sans-serif;
			color: #333;
			background-color: #f8f9fa;
			padding-top: 140px; /* 헤더와 겹치지 않도록 */
		}

		.product-page .container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
			background-color: #fff;
			border-radius: 8px;
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
		}

		.product-page .product-detail {
			display: flex;
			flex-wrap: wrap;
			gap: 20px;
			margin-bottom: 20px;
		}

		.product-page .product-detail .left,
		.product-page .product-detail .right {
			flex: 1;
			min-width: 300px;
		}

		.product-page .product-detail .left .main-image {
			width: 100%;
			height: auto;
			border-radius: 8px;
			object-fit: cover;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
		}

		.product-page .product-detail .right h1 {
			font-size: 28px;
			margin-bottom: 10px;
			color: #333;
		}

		.product-page .product-price {
			font-size: 24px;
			color: #e60000;
			margin-bottom: 10px;
			font-weight: bold;
		}

		.product-page .product-discount {
			font-size: 18px;
			color: #ff6600;
			margin-bottom: 10px;
		}

		.product-page .product-description {
			font-size: 16px;
			line-height: 1.6;
			margin-bottom: 20px;
		}

		.product-page .options {
			margin-bottom: 20px;
		}

		.product-page .options label {
			display: block;
			font-weight: bold;
			margin-bottom: 5px;
		}

		.product-page .options select {
			width: 100%;
			padding: 8px;
			margin-top: 5px;
			border: 1px solid #ddd;
			border-radius: 4px;
		}

		.product-page #quantity {
			width: 60px;
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
			margin-right: 10px;
		}

		.product-page button[type="submit"] {
			display: inline-block;
			padding: 10px 20px;
			background-color: #007bff;
			color: #fff;
			border: none;
			border-radius: 4px;
			font-size: 16px;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}

		.product-page button[type="submit"]:hover {
			background-color: #0056b3;
		}

		.product-page .shop_content {
			margin-top: 40px;
		}

		.product-page .description-images .description-image {
			width: 100%;
			border-radius: 8px;
			margin-bottom: 20px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		}

		.product-page h3 {
			margin-top: 30px;
			font-size: 22px;
			color: #333;
			border-bottom: 2px solid #ddd;
			padding-bottom: 10px;
			margin-bottom: 20px;
		}

		.product-page .review-photos {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}

		.product-page .review-thumbnail {
			width: 150px;
			height: 150px;
			object-fit: cover;
			cursor: pointer;
			border: 1px solid #ddd;
			border-radius: 4px;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
			transition: transform 0.2s;
		}

		.product-page .review-thumbnail:hover {
			transform: scale(1.05);
		}

		.product-page .modal {
			display: none;
			position: fixed;
			z-index: 10000; /* 헤더보다 높은 z-index 설정 */
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.9);
			overflow: hidden;
		}

		.product-page .modal-content {
			position: relative;
			top: 50%;
			transform: translateY(-50%);
			margin: auto;
			display: block;
			width: 90%;
			max-width: 1000px;
			height: 90%;
			object-fit: contain;
			border-radius: 8px;
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
		}

		.product-page .close {
			position: absolute;
			top: 20px;
			right: 40px;
			color: #fff;
			font-size: 40px;
			font-weight: bold;
			transition: color 0.3s ease;
			cursor: pointer;
		}

		.product-page .close:hover,
		.product-page .close:focus {
			color: #bbb;
		}

		.product-page a {
			display: inline-block;
			padding: 10px 20px;
			background-color: #007bff;
			color: #fff;
			border-radius: 4px;
			text-decoration: none;
			margin-top: 20px;
			transition: background-color 0.3s ease;
		}

		.product-page a:hover {
			background-color: #0056b3;
		}

		/* 모달 창이 열렸을 때 배경 콘텐츠 스크롤 방지 */
		body.modal-open {
			overflow: hidden;
		}

	</style>
	<link rel="stylesheet" href="/css/header.css" />
	<link rel="stylesheet" href="/css/reset.css" />
</head>

<body>
	<th:block th:include="~{fragments/header.html::header}"></th:block>
	<div class="product-page">
		<div class="container">
			<div class="product-detail">
				<!-- 왼쪽: 상품 사진 -->
				<div class="left">
					<img th:src="${shops.shopMainPhoto}" alt="메인 사진" class="main-image">
				</div>
				<!-- 오른쪽: 상품 정보 -->
				<div class="right">
					<h1 th:text="${shops.shopTitle}"></h1>
					<p class="product-price" th:text="'₩' + ${shops.shopPrice}"></p>
					<p class="product-discount" th:text="'할인율: ' + ${shops.shopDiscont} + '%'"></p>
					<p class="product-description" th:text="${shops.shopContent}"></p>
					<label>카테고리:</label>
					<p th:text="${shops.shopCategory}"></p>

					<h3>옵션</h3>
					<form action="/auth/cart" method="post" id="cartForm">
						<input type="hidden" name="shopNo" th:value="${shops.shopNo}">
						<div class="options" th:each="option : ${shopOption}">
							<label th:text="${option.shopOptionName}"></label>
							<select name="options" multiple>
								<option selected disabled th:text="${option.shopOptionName}">Select an option</option>
								<option th:each="value : ${option.shopOptionValues}"
									th:value="${value.shopOptionValueNo}" th:text="${value.shopOptionValue}">
								</option>
							</select>
						</div>
						<label for="quantity">수량:</label>
						<input type="number" id="quantity" name="quantity" value="1" min="1">
						<button type="submit">장바구니에 담기</button>
					</form>
				</div>
			</div>
			<div class="shop_content">
				<div class="description-images">
					<img th:each="image : ${shopPhotos}" th:src="${image.shopPhotoUrl}" alt="상품 설명 이미지"
						class="description-image">
				</div>
			</div>
			<div class="">
				<div>
					<a th:href="@{/shopReview/{shopNo}(shopNo=${shops.shopNo})}" class="product-link">
						<h3>리뷰작성하기</h3>
					</a>
				</div>
			</div>
			<div class="review-section">
				<h3>리뷰</h3>
				<div th:each="review : ${shopReviews}" class="review-item">
					<div class="review-profile">
						<img th:src="${review.user.UPofile}" alt="User Profile">
					</div>
					<div class="review-content">
						<p class="review-author" th:text="${review.user.UName}"></p>
						<p class="review-date"
							th:text="${#temporals.format(review.shopReviewCreated, 'yyyy-MM-dd HH:mm')}"></p>
						<p class="review-rating">별점: <span th:text="${review.shopReviewStarRating}"></span></p>
						<p th:text="${review.shopReviewContent}"></p>
						<div class="review-photos" th:if="${reviewPhotosMap[review.shopReviewNo] != null}">
							<div th:each="photo : ${reviewPhotosMap[review.shopReviewNo]}">
								<img th:src="@{${photo.shopReviewPhotoUrl}}" alt="Review Photo"
									onclick="openModal(this)">
							</div>
						</div>
					</div>
				</div>
			</div>


			<!-- 모달 창 -->
			<div id="myModal" class="modal" onclick="closeModal(event)">
				<span class="close" onclick="closeModal(event)">&times;</span>
				<img class="modal-content" id="img01">
			</div>

			<!-- 뒤로가기 버튼 -->
			<a href="#" onclick="history.back()">뒤로가기</a>
		</div>
	</div>
	<script>
		function openModal(element) {
			var modal = document.getElementById("myModal");
			var modalImg = document.getElementById("img01");
			modal.style.display = "block";
			modalImg.src = element.src;

			// 모달이 열릴 때 배경 스크롤 막기
			document.body.classList.add("modal-open");
		}

		function closeModal(event) {
			var modal = document.getElementById("myModal");
			if (event.target === modal || event.target.classList.contains('close')) {
				modal.style.display = "none";

				// 모달이 닫힐 때 배경 스크롤 허용
				document.body.classList.remove("modal-open");
			}
		}

		function deleteReview(reviewId) {
			if (confirm("정말로 이 리뷰를 삭제하시겠습니까?")) {
				$.ajax({
					type: "DELETE",
					url: "/shopReview/" + reviewId,
					success: function (response) {
						alert(response);
						location.reload();
					},
					error: function (xhr, status, error) {
						alert("리뷰 삭제에 실패했습니다.");
					}
				});
			}
		}

		$(document).ready(function () {
			$('#cartForm').on('submit', function (event) {
				event.preventDefault();

				$.ajax({
					type: 'POST',
					url: '/auth/cart',
					data: $(this).serialize(),
					success: function (res) {
						if (confirm(res)) {
							window.location.href = '/my/cart';
						}
					},
					error: function (xhr, status, error) {
						if (xhr.status == 401) {
							var msg = xhr.responseText;
							if (confirm(msg)) {
								window.location.href = '/auth/login';
							}
						}
					}
				});
			})
		})
	</script>
</body>

</html>